# Momentum Catcher - 资金动量捕捉框架

## Skill 配置

```yaml
name: momentum-catcher
description: 美股/港股资金动量捕捉分析框架，用于识别事件驱动机会、确认资金共识、捕捉动量加速期
version: 2.0.0
author: OpenClaw
triggers:
  - /momentum-catcher
  - /momentum
  - /mc
arguments:
  - name: ticker
    description: 股票代码（美股: AAPL, NVDA | 港股: 02513, 0700.HK）
    required: true
  - name: market
    description: 市场类型 (auto/us/hk)
    required: false
    default: auto
  - name: action
    description: 分析类型 (analyze/backtest/trade)
    required: false
    default: analyze
```

## v2.0 新增功能

### 美股支持
- **Alpaca 实时数据**：无延迟美股行情
- **Finnhub 集成**：Earnings Surprise、分析师目标价、公司新闻
- **Alpaca 交易**：支持纸盘/实盘交易执行

### 绩效分析
- **quantstats 集成**：专业绩效报告（Sharpe、Sortino、Max Drawdown）
- **HTML 报告生成**：一键生成可视化报告

### 数据源升级
- **统一数据接口**：自动选择最佳数据源
- **多源备份**：Alpaca → yfinance → 新浪/腾讯

### 快速开始

```bash
# 美股分析
python momentum_v2.py --ticker NVDA --market us

# 港股分析
python momentum_v2.py --ticker 02513.HK --market hk

# 带绩效回测
python momentum_v2.py --ticker AAPL --backtest

# 执行交易（美股 Alpaca）
python momentum_v2.py --ticker AAPL --trade --capital 10000
```

---

---

## 核心理论框架

### 三阶段动量模型

```
┌─────────────────────────────────────────────────────────────────┐
│                    股价动量生命周期                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Phase 1         Phase 2            Phase 3                    │
│   事件触发        资金确认           动量加速                     │
│   ─────→         ─────→            ─────→                       │
│                                                                 │
│   [催化事件]  →  [聪明钱入场]  →  [大众跟风]  →  [动量衰减]       │
│        │              │               │              │          │
│        v              v               v              v          │
│   关注但不入场    确认后建仓      持有/加仓       减仓/清仓        │
│                                                                 │
│   ◄──── 观察期 ────►◄──────── 目标捕捉区间（80%） ────────►      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 核心原则

1. **不抄底，买确认**：在资金确认信号出现后入场，放弃底部的10%
2. **不逃顶，卖衰减**：在动量衰减信号出现后离场，放弃顶部的10%
3. **多信号叠加**：事件+资金+动量三重确认才行动

---

## Phase 1: 事件扫描（Event Detection）

### 目标
识别有资金吸引力的催化事件

### 扫描清单

#### IPO事件
- [ ] 新股上市日期和定价
- [ ] 基石投资者名单和解禁日期
- [ ] 超额认购倍数（>100倍为热门）
- [ ] 上市首日表现

#### 行业热点
- [ ] AI/芯片/新能源等主题轮动
- [ ] 板块资金流入情况
- [ ] 龙头股带动效应

#### 公司里程碑
- [ ] 重大产品发布
- [ ] 大额合同签署
- [ ] 业绩预告/快报
- [ ] 战略合作公告

#### 政策催化
- [ ] 行业支持政策
- [ ] 监管政策变化
- [ ] 补贴/税收优惠

### 事件强度评分表

| 因素 | 权重 | 评分标准 | 1分 | 3分 | 5分 |
|------|------|----------|-----|-----|-----|
| 市场关注度 | 25% | 财经媒体报道、搜索指数 | 无报道 | 有报道 | 刷屏级 |
| 行业β | 25% | 所属板块近期涨幅、资金流入 | <0% | 0-5% | >10% |
| 公司α | 25% | 细分领域地位、护城河 | 跟随者 | 主要玩家 | 绝对龙头 |
| 时间窗口 | 25% | 距离事件时间、催化持续性 | >1月 | 1周-1月 | <1周 |

### 评分计算

```
事件强度 = Σ(因素得分 × 权重)

示例：
- 市场关注度: 5分 × 25% = 1.25
- 行业β: 4分 × 25% = 1.0
- 公司α: 5分 × 25% = 1.25
- 时间窗口: 4分 × 25% = 1.0
- 总分: 4.5分 ✓ 进入下一阶段
```

### 输出判断
- **事件强度 ≥ 3.5**：进入Phase 2资金确认
- **事件强度 < 3.5**：继续观察或放弃

---

## Phase 2: 资金确认（Capital Confirmation）

### 目标
确认"聪明钱"正在入场

### 核心指标（港股）

| 指标 | 数据源 | 确认阈值 | 说明 |
|------|--------|----------|------|
| 南向资金净流入 | 港交所/富途 | 连续3日净流入 | 内地资金态度 |
| 成交额异动 | 行情API | >20日均量1.5x | 资金关注度 |
| 换手率 | 行情API | >5%持续3日 | 筹码换手活跃 |
| 大宗交易 | 港交所披露 | 溢价成交 | 机构接货 |
| 卖空比例 | 港交所 | 下降趋势 | 空头回补 |

### 资金确认Checklist

```markdown
## 资金确认检查（日期：____）

### 南向资金
- [ ] 今日净流入/流出：____ 亿港元
- [ ] 连续流入天数：____ 天
- [ ] 确认状态：□通过 □未通过

### 成交量
- [ ] 今日成交额：____ 亿港元
- [ ] 20日平均成交额：____ 亿港元
- [ ] 倍数：____x
- [ ] 确认状态：□通过（>1.5x）□未通过

### 换手率
- [ ] 今日换手率：____%
- [ ] 连续>5%天数：____ 天
- [ ] 确认状态：□通过 □未通过

### 大宗交易
- [ ] 近期大宗交易：□有 □无
- [ ] 成交价格：溢价/折价 ____%
- [ ] 确认状态：□通过（溢价）□未通过

### 卖空比例
- [ ] 今日卖空比例：____%
- [ ] 趋势：□上升 □下降 □平稳
- [ ] 确认状态：□通过（下降）□未通过
```

### 资金评分规则

| 确认指标数 | 评级 | 建仓比例 |
|------------|------|----------|
| ≥4个 | 极强确认 | 80% |
| 3个 | 强确认 | 50% |
| 2个 | 中等确认 | 30% |
| ≤1个 | 弱确认 | 不入场 |

---

## Phase 3: 动量识别（Momentum Detection）

### 目标
确认价格动量正在加速

### 技术信号组合

| 信号 | 计算方式 | 确认条件 | 代码参考 |
|------|----------|----------|----------|
| 价格突破 | 突破20日高点 | 收盘价站稳 | `close > high_20d` |
| 量价配合 | 上涨日量 > 下跌日量 | 连续5日 | `up_vol_ratio > 1.2` |
| MACD金叉 | DIF上穿DEA | 零轴之上 | `macd > signal and macd > 0` |
| RSI强势 | 14日RSI | 60-80区间 | `60 < rsi_14 < 80` |
| 均线排列 | MA5 > MA10 > MA20 | 多头排列 | `ma5 > ma10 > ma20` |

### 动量信号Checklist

```markdown
## 动量信号检查（日期：____）

### 价格突破
- [ ] 今日收盘价：____
- [ ] 20日最高价：____
- [ ] 确认状态：□通过 □未通过

### 量价配合
- [ ] 近5日上涨日平均成交量：____
- [ ] 近5日下跌日平均成交量：____
- [ ] 比值：____
- [ ] 确认状态：□通过（>1.2）□未通过

### MACD
- [ ] DIF值：____
- [ ] DEA值：____
- [ ] MACD柱：____
- [ ] 金叉状态：□是 □否
- [ ] 位于零轴上方：□是 □否
- [ ] 确认状态：□通过 □未通过

### RSI
- [ ] RSI(14)值：____
- [ ] 区间：□超卖(<30) □中性(30-60) □强势(60-80) □超买(>80)
- [ ] 确认状态：□通过（60-80）□未通过

### 均线排列
- [ ] MA5：____
- [ ] MA10：____
- [ ] MA20：____
- [ ] 排列：□多头 □空头 □缠绕
- [ ] 确认状态：□通过 □未通过
```

### 动量强度评分

| 确认信号数 | 评级 | 操作建议 |
|------------|------|----------|
| 5/5 | 强动量 | 持有/加仓 |
| 4/5 | 中等动量 | 持有 |
| 3/5 | 弱动量 | 观望/减仓 |
| ≤2/5 | 无动量 | 不入场 |

---

## Phase 4: 入场决策矩阵

### 综合决策表

```
            事件强度
              高(≥4)    中(3-4)    低(<3)
           ┌─────────┬─────────┬─────────┐
     强    │  全仓   │  80%仓  │  观望   │
资   (≥4)  │  入场   │  入场   │         │
金  ───────┼─────────┼─────────┼─────────┤
确    中   │  60%仓  │  40%仓  │  观望   │
认   (3)   │  入场   │  入场   │         │
     ───────┼─────────┼─────────┼─────────┤
     弱    │  观望   │  观望   │  不参与 │
    (≤2)   └─────────┴─────────┴─────────┘
```

### 入场规则

1. **前提条件**：动量评分 ≥ 3/5（必须满足）

2. **建仓策略**：
   - 首次建仓：决策仓位的50%
   - 突破新高后：加仓30%
   - 回调确认后：剩余20%

3. **止损设置**：
   - 硬止损：入场价 -8%
   - 技术止损：跌破20日均线

### 入场决策模板

```markdown
## 入场决策记录

**股票代码**：____
**分析日期**：____

### 三维评分
| 维度 | 评分 | 等级 |
|------|------|------|
| 事件强度 | __/5 | 高/中/低 |
| 资金确认 | __/5 | 强/中/弱 |
| 动量信号 | __/5 | 强/中/弱 |

### 决策结果
- [ ] 入场
- [ ] 观望
- [ ] 不参与

### 如入场
- 建议仓位：____%
- 入场价格：____
- 止损价格：____
- 首次建仓：____%
```

---

## Phase 5: 退出决策

### 动量衰减信号

| 信号 | 描述 | 权重 | 检测方法 |
|------|------|------|----------|
| 量价背离 | 价格新高但成交量萎缩 | 30% | 价格创新高，量<前高的70% |
| 南向资金转出 | 连续2日净流出 | 25% | 南向资金连续2日为负 |
| RSI超买回落 | RSI从>80回落至70以下 | 20% | RSI曾>80，现<70 |
| MACD死叉 | DIF下穿DEA | 15% | DIF < DEA |
| 跌破均线 | 收盘价跌破10日均线 | 10% | close < MA10 |

### 退出规则

| 条件 | 操作 |
|------|------|
| 任一权重>20%的信号触发 | 减仓30% |
| 衰减信号权重累计≥50% | 清仓 |
| 跌破20日均线 | 无条件清仓 |
| 达到目标收益（如+50%） | 分批止盈 |

### 退出Checklist

```markdown
## 退出信号检查（日期：____）

### 量价背离（权重30%）
- [ ] 价格创新高：□是 □否
- [ ] 当日成交量 vs 前高成交量：____%
- [ ] 触发状态：□是（<70%）□否

### 南向资金（权重25%）
- [ ] 今日净流入：____ 亿
- [ ] 昨日净流入：____ 亿
- [ ] 连续流出天数：____
- [ ] 触发状态：□是（≥2日）□否

### RSI回落（权重20%）
- [ ] 当前RSI：____
- [ ] 近期最高RSI：____
- [ ] 触发状态：□是（曾>80现<70）□否

### MACD死叉（权重15%）
- [ ] DIF：____
- [ ] DEA：____
- [ ] 触发状态：□是（DIF<DEA）□否

### 跌破均线（权重10%）
- [ ] 收盘价：____
- [ ] MA10：____
- [ ] 触发状态：□是 □否

### 综合判断
- 触发信号权重合计：____%
- 决策：□持有 □减仓30% □清仓
```

---

## 使用示例

### 示例1：智谱AI（02513）分析

```bash
# 运行分析
claude /momentum-catcher 02513
```

**预期输出**：

```markdown
# 02513.HK 智谱AI 动量分析报告

## 基本信息
- 股票代码：02513.HK
- 公司名称：智谱AI
- 分析日期：2026-02-27
- 当前价格：XX.XX HKD

## Phase 1: 事件评分 ⭐⭐⭐⭐⭐ (4.5/5)
| 因素 | 得分 | 说明 |
|------|------|------|
| 市场关注度 | 5 | AI龙头上市，财经媒体刷屏 |
| 行业β | 4 | AI板块近期涨幅+15% |
| 公司α | 5 | 国产大模型绝对龙头 |
| 时间窗口 | 4 | 上市1周内 |

## Phase 2: 资金确认 ⭐⭐⭐⭐ (4/5)
| 指标 | 数值 | 状态 |
|------|------|------|
| 南向资金 | +2.3亿（连续5日）| ✅ |
| 成交额倍数 | 2.1x | ✅ |
| 换手率 | 8.5%（连续3日）| ✅ |
| 大宗交易 | 溢价3% | ✅ |
| 卖空比例 | 下降中 | ✅ |

## Phase 3: 动量信号 ⭐⭐⭐⭐ (4/5)
| 信号 | 数值 | 状态 |
|------|------|------|
| 价格突破 | 新高 | ✅ |
| 量价配合 | 1.8x | ✅ |
| MACD | 金叉+零轴上 | ✅ |
| RSI | 72 | ✅ |
| 均线排列 | 多头排列 | ✅ |

## 综合决策
- **事件强度**：高 (4.5)
- **资金确认**：极强 (4/5)
- **动量信号**：强 (4/5)
- **建议仓位**：80%
- **入场信号**：🟢 STRONG BUY

## 操作建议
1. 首次建仓40%，价格XX.XX
2. 突破XX.XX后加仓25%
3. 回调至MA10附近加仓15%
4. 止损位：XX.XX（-8%）
```

### 示例2：运行指标计算

```bash
# 获取实时指标
python skills/momentum-catcher/indicators.py --ticker 02513.HK

# 输出
[02513.HK] 指标计算结果 (2026-02-27)
========================================
价格指标:
  收盘价: 45.50
  20日高点: 44.20 (突破 ✅)
  MA5/10/20: 43.2/42.1/40.5 (多头排列 ✅)

成交量指标:
  今日成交额: 5.2亿
  20日均量: 2.8亿
  倍数: 1.86x (异动 ✅)
  换手率: 6.8%

动量指标:
  MACD: 0.52 (金叉 ✅)
  RSI(14): 68.5 (强势区 ✅)

综合信号: STRONG_BUY
```

### 示例3：运行回测

```bash
# 回测历史表现
python skills/momentum-catcher/backtest/run_backtest.py --ticker 02513.HK

# 输出
[02513.HK] 回测报告
========================================
回测区间: 2026-01-15 至 2026-02-27
初始资金: 100,000 HKD

策略表现:
  总收益: +42.3%
  最大回撤: -8.2%
  夏普比率: 2.15

Buy & Hold对比:
  B&H收益: +38.5%
  超额收益: +3.8%

交易记录:
  入场: 2026-01-18 @ 32.50 (资金确认信号)
  加仓: 2026-01-25 @ 35.80 (突破新高)
  持有中...
```

---

## 附录：快速检查清单

### 入场前检查

- [ ] 事件强度 ≥ 3.5
- [ ] 资金确认 ≥ 3/5
- [ ] 动量信号 ≥ 3/5
- [ ] 设置好止损位
- [ ] 确定建仓比例

### 持仓中检查（每日）

- [ ] 检查退出信号
- [ ] 更新止损位（移动止损）
- [ ] 观察南向资金变化
- [ ] 关注重大消息

### 退出检查

- [ ] 衰减信号权重 ≥ 50%？
- [ ] 跌破20日均线？
- [ ] 达到目标收益？
- [ ] 出现重大利空？

---

## 风险提示

1. 本框架仅供学习研究，不构成投资建议
2. 过往表现不代表未来收益
3. 港股市场存在汇率风险
4. 新股波动性较大，注意控制仓位
5. 严格执行止损纪律

---

## 版本历史

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| 1.0.0 | 2026-02-27 | 初始版本 |
